# è®¾è®¡å†³ç­–æ–‡æ¡£

## ðŸŽ¯ æ ¸å¿ƒè®¾è®¡åŽŸåˆ™
1. **ç”¨æˆ·æ— æ„ŸçŸ¥**ï¼šç»ä¸å¹²æ‰°ç”µè„‘æ­£å¸¸ä½¿ç”¨
2. **æä¾›è€…å®‰å…¨ç¬¬ä¸€**ï¼šä»»åŠ¡éš”ç¦»ã€è‡ªåŠ¨æ¸…ç†ã€æ— æŒä¹…åŒ–  
3. **æœ€å°å¯è¡Œæ–¹æ¡ˆ**ï¼šå…ˆè§£å†³æœ‰æ— ï¼Œå†ä¼˜åŒ–æ•ˆçŽ‡
4. **æ¸è¿›å¼éƒ¨ç½²**ï¼šå•æœºâ†’å±€åŸŸç½‘â†’äº’è”ç½‘

## ðŸ” é—²ç½®åˆ¤å®šç®—æ³•ï¼ˆæˆ‘ä»¬çš„æ ¸å¿ƒåˆ›æ–°ï¼‰

### é—®é¢˜å®šä¹‰
å¦‚ä½•å‡†ç¡®åˆ¤æ–­â€œä¸ªäººç”µè„‘çœŸé—²ç½®â€è€Œä¸ä»…ä»…æ˜¯â€œç”¨æˆ·æ— æ“ä½œâ€ï¼Ÿ

### ç®—æ³•è®¾è®¡
```python
def is_truly_idle() -> bool:
    """äº”é‡éªŒè¯çš„é—²ç½®åˆ¤å®šç®—æ³•"""
    # [å¯æŠ„éƒ¨åˆ†] åŸºç¡€æŒ‡æ ‡èŽ·å–ï¼ˆpsutil + å¹³å°APIï¼‰
    idle_time = get_user_idle_time()      # ç”¨æˆ·æ— æ“ä½œæ—¶é—´
    cpu_usage = get_cpu_usage()           # CPUä½¿ç”¨çŽ‡
    mem_usage = get_memory_usage()        # å†…å­˜ä½¿ç”¨çŽ‡
    is_locked = is_screen_locked()        # å±å¹•æ˜¯å¦é”å®š
    is_charging = is_power_charging()     # æ˜¯å¦åœ¨å……ç”µ
    
    # [æˆ‘ä»¬çš„åˆ›æ–°] æ™ºèƒ½åˆ¤å®šé€»è¾‘
    return all([
        idle_time > 300,                  # æ¡ä»¶1: ç”¨æˆ·ç¦»å¼€>5åˆ†é’Ÿ
        cpu_usage < 30,                   # æ¡ä»¶2: CPUç©ºé—²>70%
        mem_usage < 70,                   # æ¡ä»¶3: å†…å­˜å……è¶³
        is_locked,                        # æ¡ä»¶4: å±å¹•å·²é”å®š
        is_charging or has_no_battery(),  # æ¡ä»¶5: ä¸æ¶ˆè€—ç”¨æˆ·ç”µé‡
    ])
è®¾è®¡ç†ç”± 1.  300ç§’é˜ˆå€¼ï¼šé¿å…çŸ­æš‚ç¦»å¼€çš„è¯¯åˆ¤ï¼ˆæŽ¥ç”µè¯ã€ä¸ŠåŽ•æ‰€ï¼‰  2.  CPU<30%ï¼šä¿ç•™è¶³å¤Ÿèµ„æºä¿è¯ç³»ç»Ÿæµç•…  3.  å†…å­˜<70%ï¼šé˜²æ­¢å†…å­˜åŽ‹åŠ›å½±å“ç”¨æˆ·ä½“éªŒ  4.  å±å¹•é”å®šï¼šç‰©ç†å±‚é¢ç¡®ä¿ç”¨æˆ·ä¸åœ¨ä½¿ç”¨  5.  å……ç”µçŠ¶æ€ï¼šä¸æ¶ˆè€—ç”¨æˆ·ç”µæ± ï¼Œåªç”¨ç”µç½‘ç”µæº
ðŸ›¡ï¸ å®‰å…¨è¾¹ç•Œè®¾è®¡ æ‰§è¡ŒçŽ¯å¢ƒéš”ç¦»
# [å¾…æŠ„éƒ¨åˆ†] éœ€è¦æ‰¾çŽ°æˆçš„ä¸´æ—¶ç›®å½•+è¿›ç¨‹éš”ç¦»æ–¹æ¡ˆ
# GitHubæœç´¢å…³é”®è¯: "python subprocess chroot jail" æˆ– "python safe code execution sandbox"

# ä¼ªä»£ç  - å®žé™…éœ€è¦æŠ„çŽ°æˆå®žçŽ°
def execute_safely(code: str):
    # 1. åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•
    temp_dir = create_temp_dir()
    
    # 2. è®¾ç½®èµ„æºé™åˆ¶ï¼ˆCPUæ—¶é—´ã€å†…å­˜ã€æ–‡ä»¶å¤§å°ï¼‰
    set_resource_limits(max_cpu_seconds=300, max_memory_mb=1024)
    
    # 3. åœ¨å—é™çŽ¯å¢ƒä¸­æ‰§è¡Œ
    result = run_in_restricted_env(code, temp_dir)
    
    # 4. å¼ºåˆ¶æ¸…ç†ï¼ˆå³ä½¿å¼‚å¸¸ï¼‰
    force_cleanup(temp_dir)
    
    return result
ç½‘ç»œè®¿é—®æŽ§åˆ¶
é»˜è®¤ç­–ç•¥ï¼šç¦æ­¢æ‰€æœ‰ç½‘ç»œè®¿é—®
ä¾‹å¤–è§„åˆ™ï¼šå¦‚ä»»åŠ¡éœ€è¦ç½‘ç»œï¼Œéœ€æ˜Žç¡®å£°æ˜Žå¹¶ç”±æä¾›è€…æŽˆæƒ
å®žçŽ°æ–¹å¼ï¼šä½¿ç”¨ç½‘ç»œå‘½åç©ºé—´éš”ç¦»ï¼ˆLinuxï¼‰æˆ–é˜²ç«å¢™è§„åˆ™

ðŸ“¡ é€šä¿¡åè®®è®¾è®¡
{
  "task_id": "uuid-v4",
  "code": "print('Hello World')",
  "requirements": [],      // å¯é€‰ä¾èµ–
  "timeout": 300,         // è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  "resources": {          // èµ„æºéœ€æ±‚
    "cpu": 1.0,          // CPUæ ¸æ•°
    "memory": 512        // å†…å­˜MB
  },
  "created_at": "2024-01-01T00:00:00Z"
}
{
  "node_id": "macbook-pro-001",
  "status": "idle",       // idle, busy, offline
  "resources": {
    "cpu_cores": 8,
    "memory_mb": 16384,
    "platform": "macOS"
  },
  "idle_since": "2024-01-01T00:05:00Z"
}
âš™ï¸ é…ç½®ç³»ç»Ÿ åˆ†å±‚é…ç½®ä¼˜å…ˆçº§ 1.  å‘½ä»¤è¡Œå‚æ•°ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰  2.  çŽ¯å¢ƒå˜é‡ï¼ˆäº‘éƒ¨ç½²å‹å¥½ï¼‰  3.  é…ç½®æ–‡ä»¶ï¼ˆ ~/.idle-accelerator/config.yaml ï¼‰  4.  é»˜è®¤å€¼ï¼ˆå®‰å…¨ä¿å®ˆçš„é»˜è®¤å€¼ï¼‰
# èŠ‚ç‚¹é…ç½®
node:
  check_interval: 30        # é—²ç½®æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
  idle_threshold: 300       # é—²ç½®åˆ¤å®šé˜ˆå€¼ï¼ˆç§’ï¼‰
  max_task_time: 300        # ä»»åŠ¡æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
  
# è°ƒåº¦ä¸­å¿ƒé…ç½®  
scheduler:
  max_queue_size: 1000      # æœ€å¤§æŽ’é˜Ÿä»»åŠ¡æ•°
  result_ttl: 3600          # ç»“æžœä¿ç•™æ—¶é—´ï¼ˆç§’ï¼‰
  cleanup_interval: 60      # æ¸…ç†é—´éš”ï¼ˆç§’ï¼‰
ðŸ”„ æ‰©å±•æ€§è€ƒè™‘
æ°´å¹³æ‰©å±•è®¾è®¡
è°ƒåº¦ä¸­å¿ƒå¯å¤šå®žä¾‹éƒ¨ç½²ï¼ˆå…±äº«Redisé˜Ÿåˆ—ï¼‰

èŠ‚ç‚¹è‡ªåŠ¨å‘çŽ°æœºåˆ¶ï¼ˆmDNS/å¹¿æ’­ï¼‰

è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆç©ºé—²åº¦ä¼˜å…ˆã€åœ°ç†ä½ç½®ä¼˜å…ˆï¼‰

æ¥æ‰©å±•ç‚¹ æœ¬é¡¹ç›®ä½œä¸ºå¼€æºå…è´¹æ¡†æž¶ï¼Œæœªæ¥æ‰©å±•æ–¹å‘èšç„¦äºŽ æŠ€æœ¯èƒ½åŠ›æå‡ å’Œ ç¤¾åŒºä»·å€¼åˆ›é€ ï¼š 1. å¼‚æž„è®¡ç®—æ”¯æŒ â€¢  GPUè®¡ç®—ï¼šæ£€æµ‹NVIDIA/AMD GPUé—²ç½®çŠ¶æ€ï¼Œæ”¯æŒCUDA/OpenCLè®¡ç®—ä»»åŠ¡  â€¢  ç¥žç»ç½‘ç»œæŽ¨ç†ï¼šä¸ºAIæ¨¡åž‹æä¾›åˆ†å¸ƒå¼æŽ¨ç†èƒ½åŠ›  â€¢  å¤§æ•°æ®å¤„ç†ï¼šæ”¯æŒåˆ†å¸ƒå¼MapReduceç±»è®¡ç®—ä»»åŠ¡   2. æ™ºèƒ½è°ƒåº¦ä¼˜åŒ– â€¢  èµ„æºæ„ŸçŸ¥è°ƒåº¦ï¼šæ ¹æ®èŠ‚ç‚¹ç¡¬ä»¶èƒ½åŠ›ï¼ˆCPUæ ¸å¿ƒæ•°ã€å†…å­˜å¤§å°ã€GPUåž‹å·ï¼‰æ™ºèƒ½åŒ¹é…ä»»åŠ¡  â€¢  åœ°ç†ä¼˜åŒ–ï¼šä¼˜å…ˆå°†ä»»åŠ¡åˆ†é…ç»™ç½‘ç»œå»¶è¿Ÿä½Žçš„èŠ‚ç‚¹  â€¢  èƒ½è€—ä¼˜åŒ–ï¼šåœ¨ç”µè´¹ä½Žè°·æ—¶æ®µæ›´ç§¯æžè°ƒåº¦ï¼Œé«˜å³°æ—¶æ®µä¿å®ˆè°ƒåº¦   3. ç¤¾åŒºä¸Žåä½œ â€¢  è´¡çŒ®åº¦ç³»ç»Ÿï¼šæ ¹æ®èŠ‚ç‚¹è´¡çŒ®è®¡ç®—æ—¶é•¿åˆ†é…ä¿¡èª‰ç§¯åˆ†  â€¢  å…¬ç›Šè®¡ç®—ä¼˜å…ˆï¼šä¸ºç§‘å­¦ç ”ç©¶ã€æ•™è‚²é¡¹ç›®æä¾›ä¼˜å…ˆè®¡ç®—èµ„æº  â€¢  ä»»åŠ¡å¸‚åœºï¼ˆéžç›ˆåˆ©ï¼‰ï¼šç”¨æˆ·å¯ç”¨è‡ªå·±çš„é—²ç½®ç®—åŠ›äº¤æ¢ä»–äººçš„ç®—åŠ›ï¼Œå½¢æˆäº’åŠ©ç½‘ç»œ   4. å¹³å°æ‰©å±• â€¢  LinuxæœåŠ¡å™¨æ”¯æŒï¼šæ‰©å±•è‡³æ•°æ®ä¸­å¿ƒé—²ç½®æœåŠ¡å™¨  â€¢  è¾¹ç¼˜è®¾å¤‡æ”¯æŒï¼šæ ‘èŽ“æ´¾ã€æ—§æ‰‹æœºç­‰è®¾å¤‡çš„ç®—åŠ›æ±‡èš  â€¢  è·¨å¹³å°ç»Ÿä¸€ï¼šWindows/macOS/Linuxçš„ç»Ÿä¸€ç®¡ç†å’Œè°ƒåº¦   5. å®‰å…¨ä¸Žå¯é æ€§ â€¢  å¯éªŒè¯è®¡ç®—ï¼šé€šè¿‡å†—ä½™è®¡ç®—éªŒè¯ä»»åŠ¡ç»“æžœçš„æ­£ç¡®æ€§  â€¢  å®¹é”™æœºåˆ¶ï¼šä»»åŠ¡è‡ªåŠ¨é‡è¯•ã€èŠ‚ç‚¹æ•…éšœè½¬ç§»  â€¢  ç»†ç²’åº¦æƒé™ï¼šæ›´ç²¾ç»†çš„èµ„æºè®¿é—®æŽ§åˆ¶å’Œæ²™ç®±çŽ¯å¢ƒ
















