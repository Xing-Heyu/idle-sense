markdown å¤åˆ¶   ä¸‹è½½    # è®¾è®¡å†³ç­–æ–‡æ¡£

## ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. ç”¨æˆ·æ— æ„ŸçŸ¥åŸåˆ™
**å†³ç­–**: é—²ç½®æ£€æµ‹å¿…é¡»å‡†ç¡®ï¼Œç»ä¸å¹²æ‰°ç”µè„‘æ­£å¸¸ä½¿ç”¨
**å®ç°**:
- å¤šé‡æ¡ä»¶éªŒè¯ï¼ˆç©ºé—²æ—¶é—´ + CPUä½¿ç”¨ç‡ + å†…å­˜ä½¿ç”¨ç‡ + å±å¹•çŠ¶æ€ï¼‰
- ä¿å®ˆé˜ˆå€¼è®¾ç½®ï¼ˆå®å¯é”™è¿‡ï¼Œä¸å¯è¯¯åˆ¤ï¼‰
- å®æ—¶èµ„æºç›‘æ§ï¼Œè¶…å‡ºé˜ˆå€¼ç«‹å³åœæ­¢

### 2. æä¾›è€…å®‰å…¨ç¬¬ä¸€åŸåˆ™
**å†³ç­–**: è®¡ç®—èŠ‚ç‚¹å®‰å…¨æ¯”ä»»åŠ¡æ‰§è¡Œæ›´é‡è¦
**å®ç°**:
- æ²™ç®±ç¯å¢ƒæ‰§è¡Œä»»åŠ¡
- ä¸¥æ ¼çš„èµ„æºé™åˆ¶ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œï¼‰
- ä»»åŠ¡å®Œæˆåè‡ªåŠ¨æ¸…ç†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶
- é»˜è®¤ç¦æ­¢ç½‘ç»œè®¿é—®

### 3. æœ€å°å¯è¡Œæ–¹æ¡ˆåŸåˆ™
**å†³ç­–**: å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†é€æ­¥ä¼˜åŒ–æ‰©å±•
**å®ç°**:
- å†…å­˜å­˜å‚¨è€Œéæ•°æ®åº“ï¼ˆç®€åŒ–éƒ¨ç½²ï¼‰
- ç®€å•çš„å…ˆè¿›å…ˆå‡ºè°ƒåº¦ï¼ˆåˆæœŸï¼‰
- åŸºç¡€HTTP APIï¼ˆæ— å¤æ‚åè®®ï¼‰

## ğŸ” é—²ç½®åˆ¤å®šç®—æ³•è®¾è®¡

### é—®é¢˜å®šä¹‰
å¦‚ä½•å‡†ç¡®åˆ¤æ–­"ä¸ªäººç”µè„‘çœŸé—²ç½®"ï¼Ÿ

### ç®—æ³•è®¾è®¡
```python
def is_truly_idle() -> bool:
    """
    äº”é‡éªŒè¯çš„é—²ç½®åˆ¤å®šç®—æ³•
    å…¨éƒ¨æ¡ä»¶æ»¡è¶³æ‰è¿”å›True
    """
    # 1. ç”¨æˆ·æ— æ“ä½œæ—¶é—´ > 5åˆ†é’Ÿ
    idle_time = get_user_idle_time()
    
    # 2. CPUä½¿ç”¨ç‡ < 30%
    cpu_usage = get_cpu_usage()
    
    # 3. å†…å­˜ä½¿ç”¨ç‡ < 70%
    memory_usage = get_memory_usage()
    
    # 4. å±å¹•å·²é”å®šæˆ–æ— å‰å°åº”ç”¨
    screen_locked = is_screen_locked()
    
    # 5. æ­£åœ¨å……ç”µæˆ–æ— ç”µæ± è®¾å¤‡
    is_charging = is_power_charging()
    has_battery = has_battery()
    
    return all([
        idle_time > 300,           # æ¡ä»¶1: 5åˆ†é’Ÿæ— æ“ä½œ
        cpu_usage < 30.0,          # æ¡ä»¶2: CPUç©ºé—²70%ä»¥ä¸Š
        memory_usage < 70.0,       # æ¡ä»¶3: å†…å­˜å……è¶³
        screen_locked,             # æ¡ä»¶4: å±å¹•é”å®š
        is_charging or not has_battery  # æ¡ä»¶5: ä¸æ¶ˆè€—ç”¨æˆ·ç”µé‡
    ])  è®¾è®¡ç†ç”± 1.  300ç§’é˜ˆå€¼: é¿å…çŸ­æš‚ç¦»å¼€è¯¯åˆ¤ï¼ˆæ¥ç”µè¯ã€å–ç‰©å“ï¼‰  2.  CPU<30%: ä¿ç•™è¶³å¤Ÿèµ„æºä¿è¯ç³»ç»Ÿæµç•…  3.  å†…å­˜<70%: é˜²æ­¢å†…å­˜å‹åŠ›å½±å“ç”¨æˆ·ä½“éªŒ  4.  å±å¹•é”å®š: ç‰©ç†å±‚é¢ç¡®ä¿ç”¨æˆ·ä¸åœ¨ä½¿ç”¨  5.  å……ç”µçŠ¶æ€: åªä½¿ç”¨ç”µç½‘ç”µæºï¼Œä¸æ¶ˆè€—ç”µæ±    ğŸ›¡ï¸ å®‰å…¨è¾¹ç•Œè®¾è®¡ æ‰§è¡Œç¯å¢ƒéš”ç¦» python å¤åˆ¶   ä¸‹è½½    class SafeExecutionEnvironment:
    def execute_safely(self, code: str) -> str:
        # 1. åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•
        temp_dir = self._create_temp_directory()
        
        # 2. è®¾ç½®èµ„æºé™åˆ¶
        self._set_resource_limits(
            max_cpu_time=300,      # 5åˆ†é’ŸCPUæ—¶é—´
            max_memory_mb=1024,    # 1GBå†…å­˜é™åˆ¶
            max_disk_mb=100        # 100MBç£ç›˜é™åˆ¶
        )
        
        # 3. ç½‘ç»œè®¿é—®æ§åˆ¶
        if not self.config.allow_network:
            self._disable_network_access()
        
        # 4. åœ¨å—é™ç¯å¢ƒä¸­æ‰§è¡Œ
        result = self._run_in_sandbox(code, temp_dir)
        
        # 5. å¼ºåˆ¶æ¸…ç†ï¼ˆå³ä½¿å¼‚å¸¸ï¼‰
        self._force_cleanup(temp_dir)
        
        return result  å®‰å…¨æªæ–½åˆ†å±‚ 1.  è¿›ç¨‹éš”ç¦»: æ¯ä¸ªä»»åŠ¡åœ¨ç‹¬ç«‹è¿›ç¨‹ä¸­è¿è¡Œ  2.  èµ„æºé™åˆ¶: é™åˆ¶CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨  3.  æƒé™é™çº§: ä»¥éç‰¹æƒç”¨æˆ·èº«ä»½è¿è¡Œ  4.  æ–‡ä»¶æ²™ç®±: é™åˆ¶æ–‡ä»¶ç³»ç»Ÿè®¿é—®èŒƒå›´  5.  ç½‘ç»œæ§åˆ¶: é»˜è®¤ç¦æ­¢æ‰€æœ‰ç½‘ç»œè®¿é—®   âš–ï¸ å…¬å¹³è°ƒåº¦ç®—æ³• è®¾è®¡ç›®æ ‡ â€¢  å¥–åŠ±é«˜è´¡çŒ®èŠ‚ç‚¹ï¼Œä½†ä¸è®©æ–°èŠ‚ç‚¹é¥¿æ­»  â€¢  è€ƒè™‘ç­‰å¾…æ—¶é—´ï¼Œé˜²æ­¢æ— é™æœŸç­‰å¾…  â€¢  ç®€å•æ˜“æ‡‚ï¼Œæ˜“äºå®ç°å’Œç»´æŠ¤   ç®—æ³•å®ç° python å¤åˆ¶   ä¸‹è½½    def calculate_node_priority(node: NodeInfo) -> float:
    """
    è®¡ç®—èŠ‚ç‚¹ä¼˜å…ˆçº§ï¼ˆæ•°å€¼è¶Šä½ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
    """
    # åŸºç¡€ç­‰å¾…æ—¶é—´ï¼ˆç­‰å¾…è¶Šä¹…ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
    wait_score = -node.wait_time_seconds * 0.6
    
    # è´¡çŒ®åº¦å¥–åŠ±ï¼ˆä½†æœ‰ä¸Šé™ï¼‰
    contribution = min(node.tasks_completed * 0.1, 10.0)
    contrib_score = -contribution * 0.3
    
    # æ–°äººåŠ æˆï¼ˆå‰10ä¸ªä»»åŠ¡ï¼‰
    newcomer_bonus = 0
    if node.tasks_completed < 10:
        newcomer_bonus = 20 - node.tasks_completed * 2
    newcomer_score = -newcomer_bonus * 0.1
    
    # é˜²é¥¥é¥¿ï¼šç­‰å¾…è¶…è¿‡5åˆ†é’Ÿè‡ªåŠ¨æœ€é«˜ä¼˜å…ˆçº§
    if node.wait_time_seconds > 300:
        return float('-inf')
    
    # å†·å´æœŸï¼šæœ€è¿‘æ‰§è¡Œè¿‡çš„é™ä½ä¼˜å…ˆçº§
    if time.time() - node.last_task_time < 1800:  # 30åˆ†é’Ÿ
        wait_score *= 0.5
    
    return wait_score + contrib_score + newcomer_score  è°ƒåº¦ç­–ç•¥å‚æ•°     å‚æ•° å€¼ è¯´æ˜   ç­‰å¾…æ—¶é—´æƒé‡ 60% ä¸»è¦è€ƒè™‘å› ç´   è´¡çŒ®åº¦æƒé‡ 30% é€‚åº¦å¥–åŠ±è´¡çŒ®  æ–°äººåŠ æˆæƒé‡ 10% ä¿è¯æ–°èŠ‚ç‚¹æœºä¼š  è´¡çŒ®åº¦ä¸Šé™ 10åˆ† é˜²æ­¢è¿‡åº¦å€¾æ–œ  é˜²é¥¥é¥¿é˜ˆå€¼ 300ç§’ 5åˆ†é’Ÿè‡ªåŠ¨æœ€é«˜ä¼˜å…ˆçº§  å†·å´æ—¶é—´ 1800ç§’ 30åˆ†é’Ÿå†…é™ä½ä¼˜å…ˆçº§    ğŸ“¡ é€šä¿¡åè®®è®¾è®¡ ä»»åŠ¡æ ¼å¼ json å¤åˆ¶   ä¸‹è½½    {
  "task_id": "uuid-v4",
  "code": "print('Hello World')",
  "timeout": 300,
  "resources": {
    "cpu": 1.0,
    "memory": 512
  },
  "created_at": "2024-01-01T00:00:00Z"
}  èŠ‚ç‚¹å¿ƒè·³æ ¼å¼ json å¤åˆ¶   ä¸‹è½½    {
  "node_id": "macbook-pro-001",
  "status": "idle",
  "resources": {
    "cpu_cores": 8,
    "memory_mb": 16384,
    "platform": "macOS"
  },
  "idle_since": "2024-01-01T00:05:00Z"
}  è®¾è®¡è€ƒè™‘ 1.  ç®€å•JSON: æ˜“äºè§£æå’Œè°ƒè¯•  2.  æ˜ç¡®å­—æ®µ: é¿å…æ­§ä¹‰  3.  æ—¶é—´æˆ³: ISO 8601æ ¼å¼ï¼Œæ ‡å‡†åŒ–  4.  èµ„æºå•ä½: ç»Ÿä¸€ä½¿ç”¨æ ‡å‡†å•ä½ï¼ˆMBã€æ ¸å¿ƒæ•°ï¼‰   âš™ï¸ é…ç½®ç³»ç»Ÿè®¾è®¡ åˆ†å±‚é…ç½®ä¼˜å…ˆçº§ 1.  å‘½ä»¤è¡Œå‚æ•° (æœ€é«˜ä¼˜å…ˆçº§)  2.  ç¯å¢ƒå˜é‡  3.  é…ç½®æ–‡ä»¶ ( config/config.yaml )  4.  é»˜è®¤å€¼ (æœ€ä½ä¼˜å…ˆçº§ï¼Œå®‰å…¨ä¿å®ˆ)   å…³é”®é…ç½®é¡¹ yaml å¤åˆ¶   ä¸‹è½½    # è°ƒåº¦ä¸­å¿ƒé…ç½®
scheduler:
  host: "0.0.0.0"
  port: 8000
  max_queue_size: 1000
  result_ttl: 3600

# èŠ‚ç‚¹é…ç½®
node:
  scheduler_url: "http://localhost:8000"
  check_interval: 30
  idle_threshold: 300
  max_task_time: 300
  
# å®‰å…¨é…ç½®
security:
  max_memory_mb: 1024
  network_access: false
  auto_cleanup: true  ğŸ”„ æ‰©å±•æ€§è€ƒè™‘ æ°´å¹³æ‰©å±•è®¾è®¡ â€¢  è°ƒåº¦ä¸­å¿ƒå¯å¤šå®ä¾‹éƒ¨ç½²  â€¢  Redisä½œä¸ºå…±äº«ä»»åŠ¡é˜Ÿåˆ—  â€¢  è´Ÿè½½å‡è¡¡å™¨åˆ†å‘è¯·æ±‚  â€¢  æ— çŠ¶æ€è®¾è®¡ï¼Œæ˜“äºæ‰©å±•   æœªæ¥æ‰©å±•ç‚¹ 1.  GPUè®¡ç®—æ”¯æŒ: æ£€æµ‹GPUé—²ç½®çŠ¶æ€   3.  å»ä¸­å¿ƒåŒ–è°ƒåº¦: åŸºäºåŒºå—é“¾çš„ä¿¡èª‰ç³»ç»Ÿ  4.  èŠ‚èƒ½æ¨¡å¼: ç”µä»·ä½è°·æ—¶æ›´ç§¯æè°ƒåº¦   æ’ä»¶æ¶æ„é¢„ç•™ python å¤åˆ¶   ä¸‹è½½    # æ’ä»¶ç³»ç»Ÿæ¥å£
class Plugin:
    def initialize(self, config):
        pass
    
    def process(self, data):
        pass
    
    def cleanup(self):
        pass

# æ’ä»¶æ³¨å†Œæœºåˆ¶
PLUGIN_REGISTRY = {
    "detectors": {},
    "schedulers": {},
    "executors": {}
}  ğŸ“Š æ€§èƒ½ä¸å¯é æ€§ æ€§èƒ½ç›®æ ‡ â€¢  ä»»åŠ¡è°ƒåº¦å»¶è¿Ÿ < 100ms  â€¢  æ”¯æŒ1000+èŠ‚ç‚¹å¹¶å‘  â€¢  å†…å­˜ä½¿ç”¨ < 512MBï¼ˆåŸºç¡€è¿è¡Œï¼‰  â€¢  å¯åŠ¨æ—¶é—´ < 5ç§’   å¯é æ€§æªæ–½ 1.  ä»»åŠ¡æŒä¹…åŒ–: å®šæœŸä¿å­˜åˆ°ç£ç›˜  2.  å¿ƒè·³æ£€æµ‹: èŠ‚ç‚¹å¥åº·çŠ¶æ€ç›‘æ§  3.  è‡ªåŠ¨æ¢å¤: è¿›ç¨‹å´©æºƒåè‡ªåŠ¨é‡å¯  4.  ä¼˜é›…é™çº§: éƒ¨åˆ†åŠŸèƒ½å¤±è´¥ä¸å½±å“æ ¸å¿ƒ   ç›‘æ§æŒ‡æ ‡ â€¢  æ´»è·ƒèŠ‚ç‚¹æ•°é‡  â€¢  ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦  â€¢  å¹³å‡ä»»åŠ¡æ‰§è¡Œæ—¶é—´  â€¢  ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡  â€¢  é”™è¯¯ç‡ç»Ÿè®¡   ğŸ¨ ç”¨æˆ·ä½“éªŒè®¾è®¡ ç½‘é¡µç•Œé¢åŸåˆ™ 1.  ç®€æ´ç›´è§‚: åŠŸèƒ½æ˜ç¡®ï¼Œæ— å†—ä½™ä¿¡æ¯  2.  å®æ—¶åé¦ˆ: ä»»åŠ¡çŠ¶æ€å®æ—¶æ›´æ–°  3.  æ¸è¿›æŠ«éœ²: é«˜çº§åŠŸèƒ½éšè—ï¼Œéœ€è¦æ—¶å±•å¼€  4.  ä¸€è‡´æ€§: ç•Œé¢å…ƒç´ å’Œè¡Œä¸ºä¸€è‡´   APIè®¾è®¡åŸåˆ™ 1.  RESTfulé£æ ¼: èµ„æºå¯¼å‘ï¼ŒHTTPæ–¹æ³•æ˜ç¡®  2.  ä¸€è‡´å“åº”æ ¼å¼: ç»Ÿä¸€æˆåŠŸ/é”™è¯¯å“åº”ç»“æ„  3.  ç‰ˆæœ¬ç®¡ç†: APIç‰ˆæœ¬åŒ–ï¼Œå‘åå…¼å®¹  4.  è¯¦ç»†æ–‡æ¡£: æ¯ä¸ªç«¯ç‚¹æœ‰æ˜ç¡®è¯´æ˜å’Œç¤ºä¾‹   ğŸ” æŠ€æœ¯é€‰å‹ç†ç”± Python â€¢  ç†ç”±: å¿«é€Ÿå¼€å‘ï¼Œä¸°å¯Œçš„ç§‘å­¦è®¡ç®—åº“  â€¢  æ›¿ä»£æ–¹æ¡ˆ: Goï¼ˆæ€§èƒ½æ›´å¥½ä½†å¼€å‘é€Ÿåº¦æ…¢ï¼‰  â€¢  æƒè¡¡: é€‰æ‹©å¼€å‘é€Ÿåº¦è€Œéæè‡´æ€§èƒ½   FastAPI â€¢  ç†ç”±: ç°ä»£å¼‚æ­¥æ¡†æ¶ï¼Œè‡ªåŠ¨APIæ–‡æ¡£  â€¢  æ›¿ä»£æ–¹æ¡ˆ: Flaskï¼ˆæ›´è½»é‡ä½†åŠŸèƒ½è¾ƒå°‘ï¼‰  â€¢  æƒè¡¡: é€‰æ‹©åŠŸèƒ½å®Œæ•´æ€§å’Œå¼€å‘æ•ˆç‡   å†…å­˜å­˜å‚¨ â€¢  ç†ç”±: ç®€åŒ–éƒ¨ç½²ï¼Œæ— éœ€å¤–éƒ¨æ•°æ®åº“  â€¢  æ›¿ä»£æ–¹æ¡ˆ: Redisï¼ˆæ€§èƒ½æ›´å¥½ä½†å¢åŠ ä¾èµ–ï¼‰  â€¢  æƒè¡¡: é€‰æ‹©ç®€å•æ€§ï¼Œæœªæ¥å¯æ›¿æ¢   Streamlit â€¢  ç†ç”±: å¿«é€Ÿæ„å»ºæ•°æ®åº”ç”¨ï¼Œæ— éœ€å‰ç«¯çŸ¥è¯†  â€¢  æ›¿ä»£æ–¹æ¡ˆ: React + FastAPIï¼ˆæ›´çµæ´»ä½†å¤æ‚ï¼‰  â€¢  æƒè¡¡: é€‰æ‹©å¼€å‘é€Ÿåº¦ï¼Œä¸“æ³¨åç«¯é€»è¾‘
