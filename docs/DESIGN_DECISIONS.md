# è®¾è®¡å†³ç­–æ–‡æ¡£

## ðŸŽ¯ æ ¸å¿ƒè®¾è®¡åŽŸåˆ™
1. **ç”¨æˆ·æ— æ„ŸçŸ¥**ï¼šç»ä¸å¹²æ‰°ç”µè„‘æ­£å¸¸ä½¿ç”¨
2. **æä¾›è€…å®‰å…¨ç¬¬ä¸€**ï¼šä»»åŠ¡éš”ç¦»ã€è‡ªåŠ¨æ¸…ç†ã€æ— æŒä¹…åŒ–  
3. **æœ€å°å¯è¡Œæ–¹æ¡ˆ**ï¼šå…ˆè§£å†³æœ‰æ— ï¼Œå†ä¼˜åŒ–æ•ˆçŽ‡
4. **æ¸è¿›å¼éƒ¨ç½²**ï¼šå•æœºâ†’å±€åŸŸç½‘â†’äº’è”ç½‘

## ðŸ” é—²ç½®åˆ¤å®šç®—æ³•ï¼ˆæˆ‘ä»¬çš„æ ¸å¿ƒåˆ›æ–°ï¼‰

### é—®é¢˜å®šä¹‰
å¦‚ä½•å‡†ç¡®åˆ¤æ–­â€œä¸ªäººç”µè„‘çœŸé—²ç½®â€è€Œä¸ä»…ä»…æ˜¯â€œç”¨æˆ·æ— æ“ä½œâ€ï¼Ÿ

### ç®—æ³•è®¾è®¡
```python
def is_truly_idle() -> bool:
    """äº”é‡éªŒè¯çš„é—²ç½®åˆ¤å®šç®—æ³•"""
    # [å¯æŠ„éƒ¨åˆ†] åŸºç¡€æŒ‡æ ‡èŽ·å–ï¼ˆpsutil + å¹³å°APIï¼‰
    idle_time = get_user_idle_time()      # ç”¨æˆ·æ— æ“ä½œæ—¶é—´
    cpu_usage = get_cpu_usage()           # CPUä½¿ç”¨çŽ‡
    mem_usage = get_memory_usage()        # å†…å­˜ä½¿ç”¨çŽ‡
    is_locked = is_screen_locked()        # å±å¹•æ˜¯å¦é”å®š
    is_charging = is_power_charging()     # æ˜¯å¦åœ¨å……ç”µ
    
    # [æˆ‘ä»¬çš„åˆ›æ–°] æ™ºèƒ½åˆ¤å®šé€»è¾‘
    return all([
        idle_time > 300,                  # æ¡ä»¶1: ç”¨æˆ·ç¦»å¼€>5åˆ†é’Ÿ
        cpu_usage < 30,                   # æ¡ä»¶2: CPUç©ºé—²>70%
        mem_usage < 70,                   # æ¡ä»¶3: å†…å­˜å……è¶³
        is_locked,                        # æ¡ä»¶4: å±å¹•å·²é”å®š
        is_charging or has_no_battery(),  # æ¡ä»¶5: ä¸æ¶ˆè€—ç”¨æˆ·ç”µé‡
    ])
è®¾è®¡ç†ç”± 1.  300ç§’é˜ˆå€¼ï¼šé¿å…çŸ­æš‚ç¦»å¼€çš„è¯¯åˆ¤ï¼ˆæŽ¥ç”µè¯ã€ä¸ŠåŽ•æ‰€ï¼‰  2.  CPU<30%ï¼šä¿ç•™è¶³å¤Ÿèµ„æºä¿è¯ç³»ç»Ÿæµç•…  3.  å†…å­˜<70%ï¼šé˜²æ­¢å†…å­˜åŽ‹åŠ›å½±å“ç”¨æˆ·ä½“éªŒ  4.  å±å¹•é”å®šï¼šç‰©ç†å±‚é¢ç¡®ä¿ç”¨æˆ·ä¸åœ¨ä½¿ç”¨  5.  å……ç”µçŠ¶æ€ï¼šä¸æ¶ˆè€—ç”¨æˆ·ç”µæ± ï¼Œåªç”¨ç”µç½‘ç”µæº
ðŸ›¡ï¸ å®‰å…¨è¾¹ç•Œè®¾è®¡ æ‰§è¡ŒçŽ¯å¢ƒéš”ç¦»
# [å¾…æŠ„éƒ¨åˆ†] éœ€è¦æ‰¾çŽ°æˆçš„ä¸´æ—¶ç›®å½•+è¿›ç¨‹éš”ç¦»æ–¹æ¡ˆ
# GitHubæœç´¢å…³é”®è¯: "python subprocess chroot jail" æˆ– "python safe code execution sandbox"

# ä¼ªä»£ç  - å®žé™…éœ€è¦æŠ„çŽ°æˆå®žçŽ°
def execute_safely(code: str):
    # 1. åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•
    temp_dir = create_temp_dir()
    
    # 2. è®¾ç½®èµ„æºé™åˆ¶ï¼ˆCPUæ—¶é—´ã€å†…å­˜ã€æ–‡ä»¶å¤§å°ï¼‰
    set_resource_limits(max_cpu_seconds=300, max_memory_mb=1024)
    
    # 3. åœ¨å—é™çŽ¯å¢ƒä¸­æ‰§è¡Œ
    result = run_in_restricted_env(code, temp_dir)
    
    # 4. å¼ºåˆ¶æ¸…ç†ï¼ˆå³ä½¿å¼‚å¸¸ï¼‰
    force_cleanup(temp_dir)
    
    return result
